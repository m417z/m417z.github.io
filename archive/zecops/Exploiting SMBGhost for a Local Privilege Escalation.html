<!DOCTYPE html>
<html lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="https://gmpg.org/xfn/11">


 <title>Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC - ZecOps Blog</title>
 <meta name="robots" content="index, follow">
 <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
 <link rel="canonical" href="https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/">
 <meta property="og:locale" content="en_US">
 <meta property="og:type" content="article">
 
 <meta property="og:description" content="Introduction CVE-2020-0796 is a bug in the compression mechanism of SMBv3.1.1, also known as “SMBGhost”. The bug affects Windows 10 versions 1903 and 1909, and it was announced and patched by Microsoft about three weeks ago. Once we heard about it, we skimmed over the details and created a quick POC (proof of concept) that … Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC Read More »">
<meta property="og:url" content="https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/">
<meta property="og:site_name" content="ZecOps Blog">
<meta property="article:published_time" content="2020-03-31T20:27:29+00:00">
<meta property="article:modified_time" content="2020-05-24T18:28:25+00:00">
<meta property="og:image" content="blog_zecops_com_wp-content_uploads/2020/03/ghost-2a.jpg">
<meta property="og:image:width" content="4080">
<meta property="og:image:height" content="2448">
<meta name="twitter:card" content="summary_large_image">
<script async="" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/get_counts"></script><script type="text/javascript" async="" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/insight.js"></script><script async="" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/5e08fc03de9d4c0012d1058c.js"></script><script type="text/javascript" async="" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/analytics.js"></script><script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://blog.zecops.com/#organization","name":"ZecOps","url":"https://blog.zecops.com/","sameAs":[],"logo":{"@type":"ImageObject","@id":"https://blog.zecops.com/#logo","inLanguage":"en-US","url":"blog_zecops_com_wp-content_uploads/2019/01/zecops-logo.png","width":260,"height":80,"caption":"ZecOps"},"image":{"@id":"https://blog.zecops.com/#logo"}},{"@type":"WebSite","@id":"https://blog.zecops.com/#website","url":"https://blog.zecops.com/","name":"ZecOps Blog","description":"ZecOps Research Team","publisher":{"@id":"https://blog.zecops.com/#organization"},"potentialAction":[{"@type":"SearchAction","target":"https://blog.zecops.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#primaryimage","inLanguage":"en-US","url":"blog_zecops_com_wp-content_uploads/2020/03/ghost-2a.jpg","width":4080,"height":2448},{"@type":"WebPage","@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#webpage","url":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/","name":"Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC - ZecOps Blog","isPartOf":{"@id":"https://blog.zecops.com/#website"},"primaryImageOfPage":{"@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#primaryimage"},"datePublished":"2020-03-31T20:27:29+00:00","dateModified":"2020-05-24T18:28:25+00:00","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/"]}]},{"@type":"Article","@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#article","isPartOf":{"@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#webpage"},"author":{"@id":"https://blog.zecops.com/#/schema/person/caf00b482877f6db964e26781da57248"},"headline":"Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC","datePublished":"2020-03-31T20:27:29+00:00","dateModified":"2020-05-24T18:28:25+00:00","commentCount":0,"mainEntityOfPage":{"@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#webpage"},"publisher":{"@id":"https://blog.zecops.com/#organization"},"image":{"@id":"https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#primaryimage"},"articleSection":"vulnerabilities","inLanguage":"en-US","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/#respond"]}]},{"@type":["Person"],"@id":"https://blog.zecops.com/#/schema/person/caf00b482877f6db964e26781da57248","name":"ZecOps Research Team","image":{"@type":"ImageObject","@id":"https://blog.zecops.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/91ca55e461911ff543c202cc7e0d253e?s=96&d=mm&r=g","caption":"ZecOps Research Team"}}]}</script>

<link rel="dns-prefetch" href="https://fonts.googleapis.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="ZecOps Blog » Feed" href="https://blog.zecops.com/feed/">
<link rel="alternate" type="application/rss+xml" title="ZecOps Blog » Comments Feed" href="https://blog.zecops.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="ZecOps Blog » Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC Comments Feed" href="https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/feed/">
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.zecops.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.4.1"}};
			/*! This file is auto-generated */
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/wp-emoji-release.js" type="text/javascript" defer="defer"></script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="astra-theme-css-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/style_002.css" type="text/css" media="all">
<style id="astra-theme-css-inline-css" type="text/css">
html{font-size:93.75%;}a,.page-title{color:#009699;}a:hover,a:focus{color:#3a3a3a;}body,button,input,select,textarea{font-family:'Montserrat',sans-serif;font-weight:400;font-size:15px;font-size:1rem;line-height:1.2;}blockquote{border-color:rgba(0,150,153,0.05);}p,.entry-content p{margin-bottom:1.4em;}h1,.entry-content h1,h2,.entry-content h2,h3,.entry-content h3,h4,.entry-content h4,h5,.entry-content h5,h6,.entry-content h6,.site-title,.site-title a{font-family:'Oswald',sans-serif;font-weight:500;}.site-title{font-size:35px;font-size:2.3333333333333rem;}header .site-logo-img .custom-logo-link img{max-width:165px;}.astra-logo-svg{width:165px;}.ast-archive-description .ast-archive-title{font-size:40px;font-size:2.6666666666667rem;}.site-header .site-description{font-size:15px;font-size:1rem;}.entry-title{font-size:40px;font-size:2.6666666666667rem;}.comment-reply-title{font-size:24px;font-size:1.6rem;}.ast-comment-list #cancel-comment-reply-link{font-size:15px;font-size:1rem;}h1,.entry-content h1{font-size:40px;font-size:2.6666666666667rem;}h2,.entry-content h2{font-size:30px;font-size:2rem;}h3,.entry-content h3{font-size:25px;font-size:1.6666666666667rem;}h4,.entry-content h4{font-size:20px;font-size:1.3333333333333rem;}h5,.entry-content h5{font-size:18px;font-size:1.2rem;}h6,.entry-content h6{font-size:15px;font-size:1rem;}.ast-single-post .entry-title,.page-title{font-size:30px;font-size:2rem;}#secondary,#secondary button,#secondary input,#secondary select,#secondary textarea{font-size:15px;font-size:1rem;}::selection{background-color:#009699;color:#ffffff;}body,h1,.entry-title a,.entry-content h1,h2,.entry-content h2,h3,.entry-content h3,h4,.entry-content h4,h5,.entry-content h5,h6,.entry-content h6{color:#3a3a3a;}.tagcloud a:hover,.tagcloud a:focus,.tagcloud a.current-item{color:#ffffff;border-color:#009699;background-color:#009699;}.main-header-menu a,.ast-header-custom-item a{color:#3a3a3a;}.main-header-menu li:hover > a,.main-header-menu li:hover > .ast-menu-toggle,.main-header-menu .ast-masthead-custom-menu-items a:hover,.main-header-menu li.focus > a,.main-header-menu li.focus > .ast-menu-toggle,.main-header-menu .current-menu-item > a,.main-header-menu .current-menu-ancestor > a,.main-header-menu .current_page_item > a,.main-header-menu .current-menu-item > .ast-menu-toggle,.main-header-menu .current-menu-ancestor > .ast-menu-toggle,.main-header-menu .current_page_item > .ast-menu-toggle{color:#009699;}input:focus,input[type="text"]:focus,input[type="email"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="reset"]:focus,input[type="search"]:focus,textarea:focus{border-color:#009699;}input[type="radio"]:checked,input[type=reset],input[type="checkbox"]:checked,input[type="checkbox"]:hover:checked,input[type="checkbox"]:focus:checked,input[type=range]::-webkit-slider-thumb{border-color:#009699;background-color:#009699;box-shadow:none;}.site-footer a:hover + .post-count,.site-footer a:focus + .post-count{background:#009699;border-color:#009699;}.footer-adv .footer-adv-overlay{border-top-style:solid;border-top-color:#7a7a7a;}.ast-comment-meta{line-height:1.666666667;font-size:12px;font-size:0.8rem;}.single .nav-links .nav-previous,.single .nav-links .nav-next,.single .ast-author-details .author-title,.ast-comment-meta{color:#009699;}.menu-toggle,button,.ast-button,.button,input#submit,input[type="button"],input[type="submit"],input[type="reset"]{border-radius:2px;padding:10px 40px;color:#ffffff;border-color:#009699;background-color:#009699;}button:focus,.menu-toggle:hover,button:hover,.ast-button:hover,.button:hover,input[type=reset]:hover,input[type=reset]:focus,input#submit:hover,input#submit:focus,input[type="button"]:hover,input[type="button"]:focus,input[type="submit"]:hover,input[type="submit"]:focus{color:#ffffff;border-color:#3a3a3a;background-color:#3a3a3a;}.entry-meta,.entry-meta *{line-height:1.45;color:#009699;}.entry-meta a:hover,.entry-meta a:hover *,.entry-meta a:focus,.entry-meta a:focus *{color:#3a3a3a;}blockquote,blockquote a{color:#000000;}.ast-404-layout-1 .ast-404-text{font-size:200px;font-size:13.333333333333rem;}.widget-title{font-size:21px;font-size:1.4rem;color:#3a3a3a;}#cat option,.secondary .calendar_wrap thead a,.secondary .calendar_wrap thead a:visited{color:#009699;}.secondary .calendar_wrap #today,.ast-progress-val span{background:#009699;}.secondary a:hover + .post-count,.secondary a:focus + .post-count{background:#009699;border-color:#009699;}.calendar_wrap #today > a{color:#ffffff;}.ast-pagination a,.page-links .page-link,.single .post-navigation a{color:#009699;}.ast-pagination a:hover,.ast-pagination a:focus,.ast-pagination > span:hover:not(.dots),.ast-pagination > span.current,.page-links > .page-link,.page-links .page-link:hover,.post-navigation a:hover{color:#3a3a3a;}.ast-header-break-point .ast-mobile-menu-buttons-minimal.menu-toggle{background:transparent;color:#009699;}.ast-header-break-point .ast-mobile-menu-buttons-outline.menu-toggle{background:transparent;border:1px solid #009699;color:#009699;}.ast-header-break-point .ast-mobile-menu-buttons-fill.menu-toggle{background:#009699;}@media (min-width:545px){.ast-page-builder-template .comments-area,.single.ast-page-builder-template .entry-header,.single.ast-page-builder-template .post-navigation{max-width:1240px;margin-left:auto;margin-right:auto;}}body,.ast-separate-container{background-color:#2d2d2d;}@media (max-width:768px){.ast-archive-description .ast-archive-title{font-size:40px;}.entry-title{font-size:30px;}h1,.entry-content h1{font-size:30px;}h2,.entry-content h2{font-size:25px;}h3,.entry-content h3{font-size:20px;}.ast-single-post .entry-title,.page-title{font-size:30px;}}@media (max-width:544px){.ast-archive-description .ast-archive-title{font-size:40px;}.entry-title{font-size:30px;}h1,.entry-content h1{font-size:30px;}h2,.entry-content h2{font-size:25px;}h3,.entry-content h3{font-size:20px;}.ast-single-post .entry-title,.page-title{font-size:30px;}.ast-header-break-point .site-branding img,.ast-header-break-point #masthead .site-logo-img .custom-logo-link img{max-width:130px;}.astra-logo-svg{width:130px;}.ast-header-break-point .site-logo-img .custom-mobile-logo-link img{max-width:130px;}}@media (max-width:768px){html{font-size:85.5%;}}@media (max-width:544px){html{font-size:85.5%;}}@media (min-width:769px){.ast-container{max-width:1240px;}}@font-face {font-family: "Astra";src: url( https://blog.zecops.com/wp-content/themes/astra/assets/fonts/astra.woff) format("woff"),url( https://blog.zecops.com/wp-content/themes/astra/assets/fonts/astra.ttf) format("truetype"),url( https://blog.zecops.com/wp-content/themes/astra/assets/fonts/astra.svg#astra) format("svg");font-weight: normal;font-style: normal;}@media (max-width:921px) {.main-header-bar .main-header-bar-navigation{display:none;}}@media (min-width:769px){.blog .site-content > .ast-container,.archive .site-content > .ast-container,.search .site-content > .ast-container{max-width:1200px;}}.ast-desktop .main-header-menu.submenu-with-border .sub-menu,.ast-desktop .main-header-menu.submenu-with-border .children,.ast-desktop .main-header-menu.submenu-with-border .astra-full-megamenu-wrapper{border-color:#009699;}.ast-desktop .main-header-menu.submenu-with-border .sub-menu,.ast-desktop .main-header-menu.submenu-with-border .children{border-top-width:2px;border-right-width:0px;border-left-width:0px;border-bottom-width:0px;border-style:solid;}.ast-desktop .main-header-menu.submenu-with-border .sub-menu .sub-menu,.ast-desktop .main-header-menu.submenu-with-border .children .children{top:-2px;}.ast-desktop .main-header-menu.submenu-with-border .sub-menu a,.ast-desktop .main-header-menu.submenu-with-border .children a{border-bottom-width:0px;border-style:solid;border-color:#eaeaea;}@media (min-width:769px){.main-header-menu .sub-menu li.ast-left-align-sub-menu:hover > ul,.main-header-menu .sub-menu li.ast-left-align-sub-menu.focus > ul{margin-left:-0px;}}.ast-small-footer{border-top-style:solid;border-top-width:1px;border-top-color:#7a7a7a;}.ast-small-footer-wrap{text-align:center;}@media (max-width:920px){.ast-404-layout-1 .ast-404-text{font-size:100px;font-size:6.6666666666667rem;}}
.ast-header-break-point .site-header{border-bottom-width:1px;}@media (min-width:769px){.main-header-bar{border-bottom-width:1px;}}.main-header-menu .menu-item, .main-header-bar .ast-masthead-custom-menu-items{-js-display:flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;}.main-header-menu > .menu-item > a{height:100%;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-js-display:flex;display:flex;}
@media (min-width:769px){.ast-theme-transparent-header #masthead{position:absolute;left:0;right:0;}.ast-theme-transparent-header .main-header-bar, .ast-theme-transparent-header.ast-header-break-point .main-header-bar{background:none;}body.elementor-editor-active.ast-theme-transparent-header #masthead, .fl-builder-edit .ast-theme-transparent-header #masthead, body.vc_editor.ast-theme-transparent-header #masthead{z-index:0;}.ast-header-break-point.ast-replace-site-logo-transparent.ast-theme-transparent-header .ast-mobile-header-logo{display:none;}.ast-header-break-point.ast-replace-site-logo-transparent.ast-theme-transparent-header .transparent-custom-logo .custom-logo{display:inline-block;}.ast-theme-transparent-header .ast-above-header{background-image:none;background-color:transparent;}.ast-theme-transparent-header .ast-below-header{background-image:none;background-color:transparent;}}@media (max-width:768px){.ast-theme-transparent-header #masthead{position:absolute;left:0;right:0;}.ast-theme-transparent-header .main-header-bar, .ast-theme-transparent-header.ast-header-break-point .main-header-bar{background:none;}body.elementor-editor-active.ast-theme-transparent-header #masthead, .fl-builder-edit .ast-theme-transparent-header #masthead, body.vc_editor.ast-theme-transparent-header #masthead{z-index:0;}.ast-header-break-point.ast-replace-site-logo-transparent.ast-theme-transparent-header .ast-mobile-header-logo{display:none;}.ast-header-break-point.ast-replace-site-logo-transparent.ast-theme-transparent-header .transparent-custom-logo .custom-logo{display:inline-block;}.ast-theme-transparent-header .ast-above-header{background-image:none;background-color:transparent;}.ast-theme-transparent-header .ast-below-header{background-image:none;background-color:transparent;}}.ast-theme-transparent-header .main-header-bar, .ast-theme-transparent-header .site-header{border-bottom-width:0;}
</style>
<link rel="stylesheet" id="astra-google-fonts-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/css_002.css" type="text/css" media="all">
<link rel="stylesheet" id="astra-menu-animation-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/menu-animation.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-block-library-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-icons-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/elementor-icons.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-animations-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/animations.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-frontend-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/frontend_002.css" type="text/css" media="all">
<style id="elementor-frontend-inline-css" type="text/css">
.elementor-73 .elementor-element.elementor-element-52e7df60:not(.elementor-motion-effects-element-type-background), .elementor-73 .elementor-element.elementor-element-52e7df60 > .elementor-motion-effects-container > .elementor-motion-effects-layer{background-image:url("blog_zecops_com_wp-content_uploads/2020/03/ghost-2a.jpg");}
</style>
<link rel="stylesheet" id="elementor-pro-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/frontend.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/font-awesome.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-global-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/global.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-post-36-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/post-36.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-post-66-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/post-66.css" type="text/css" media="all">
<link rel="stylesheet" id="elementor-post-73-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/post-73.css" type="text/css" media="all">
<link rel="stylesheet" id="google-fonts-1-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/css.css" type="text/css" media="all">
<link rel="https://api.w.org/" href="https://blog.zecops.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.zecops.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.zecops.com/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.4.1">
<link rel="shortlink" href="https://blog.zecops.com/?p=846">
<link rel="alternate" type="application/json+oembed" href="https://blog.zecops.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.zecops.com%2Fvulnerabilities%2Fexploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc%2F">
<link rel="alternate" type="text/xml+oembed" href="https://blog.zecops.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.zecops.com%2Fvulnerabilities%2Fexploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc%2F&amp;format=xml">

<style type="text/css">
/* Add your CSS code here.

For example:
.example {
    color: red;
}

For brushing up on your CSS knowledge, check out http://www.w3schools.com/css/css_syntax.asp

End of comment */ 

.nice-code-block {
  padding: 24px 0;
    border-radius: 10px;
}</style>


<style type="text/css">
/* Add your CSS code here.

For example:
.example {
    color: red;
}

For brushing up on your CSS knowledge, check out http://www.w3schools.com/css/css_syntax.asp

End of comment */ 

.are-you-at-risk-container {
  background: url("blog_zecops_com_wp-content_uploads/2020/04/dark-plexus-lowres.jpg")
    no-repeat;
  background-size: cover;
  background-position: center center;
  background-color: #000;
  color: white;
  display: flex;
  padding: 24px 72px;
  align-items: center;
  justify-content: center;
  position: relative;
  z-index: 2;
  border-radius: 8px;
  overflow: hidden;
}

.are-you-at-risk-container::after {
  content: "";
  background: rgba(0, 0, 0, 0.4);
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  position: absolute;
  z-index: 1;
}

.are-you-at-risk-img {
  margin-right: 24px;
  z-index: 10;
}

.are-you-at-risk-title {
  margin-right: 24px;
  font-family: "Oswald", sans-serif;
  text-transform: uppercase;
  font-weight: bold;
  font-size: 30px;
  z-index: 10;
  line-height: 1;
}
#are-you-at-risk-form {
  z-index: 10;
}
#are-you-at-risk-btn {
  border: none;
  font-family: "Montserrat", sans-serif;
  background: #009699;
  color: white;
  font-weight: bold;
  font-size: 18px;
  padding: 12px 24px;
  border-radius: 4px;
  z-index: 10;
}

#are-you-at-risk-btn:hover {
  background: #007173;
}
#are-you-at-risk-btn:focus {
  outline: none;
  box-shadow: 0 0 0 2px #33c9cc;
}

#are-you-at-risk-btn:active {
  background: #000;
}

@media only screen and (max-width: 758px) {
  .are-you-at-risk-container {
    padding: 24px 24px;
  }
}

@media only screen and (max-width: 595px) {
  .are-you-at-risk-container {
    flex-direction: column;
    text-align: center;
  }
  .are-you-at-risk-img,
  .are-you-at-risk-title {
    margin-right: 0;
    margin-bottom: 16px;
  }
}

@media only screen and (max-width: 360px) {
  .are-you-at-risk-title {
    font-size: 24px;
  }
}</style>


<style type="text/css">
@media (max-width: 800px) {
  .mc4wp-form-fields .signup-form{
    display: block !important;
  }
  .mc4wp-form-fields .signup-form .signup-field{
  	width: 220px;
    margin-bottom: 8px;
  }
  
  .elementor-widget-search-form{
  	display: none;
  }
  
  .elementor-36 .elementor-element.elementor-element-8bde1fb {
  	padding-top: 0;
    padding-bottom: 0;
  }
}

@media (max-width: 398px) {
  .mc4wp-form-fields ul li:nth-child(2) {
  	margin-bottom: 24px !important;
  }
  .mc4wp-form-fields .zecops-blog-callout-nospace {
  	padding-top: 0;
  }
}

.mc4wp-alert.mc4wp-success {
    box-sizing: border-box;
    background-color: #fafafa;
    padding: 25px;
    border: 2px solid #ccc;
}

.mc4wp-alert.mc4wp-success p {
    margin-bottom: 0;
}</style>


<style type="text/css">
/* Add your CSS code here.

For example:
.example {
    color: red;
}

For brushing up on your CSS knowledge, check out http://www.w3schools.com/css/css_syntax.asp

End of comment */ 


/*@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,700;1,400;1,700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap');*/</style>


<style type="text/css">
/* Add your CSS code here.

For example:
.example {
    color: red;
}

For brushing up on your CSS knowledge, check out http://www.w3schools.com/css/css_syntax.asp

End of comment */ 


pre.pre-unstyled code {
  background-color: transparent !important;
  color: #333 !important;
}</style>


<style type="text/css">
/* Add your CSS code here.

For example:
.example {
    color: red;
}

For brushing up on your CSS knowledge, check out http://www.w3schools.com/css/css_syntax.asp

End of comment */ 

.inline-code-block {
  box-sizing: border-box;
  background-color: #eee;
  display: inline-block;
  padding: 16px;
  font-size: 14px;
  font-family: "Courier 10 Pitch",Courier,monospace;
  margin: 4px 0 4px;
}</style>


<style type="text/css">
.zecops-blog-callout {
  box-sizing: border-box;
  background-color: #fafafa;
  padding: 40px;
  margin-top: 56px;
  border: 2px solid #ccc;
}

.zecops-blog-callout-nospace {
  box-sizing: border-box;
  background-color: #fafafa;
  padding: 40px;
  margin-bottom: 56px;
  border: 2px solid #ccc;
}

.zecops-blog-callout-small {
  box-sizing: border-box;
  background-color: #fafafa;
  padding: 24px;
  border: 2px solid #ccc;
}</style>


<style type="text/css">
.elementor-widget-theme-post-content a {
    text-decoration: underline;
    color: #1979FF;
    transition: none;
}
.elementor-widget-theme-post-content a:hover {
	text-decoration: none;
}</style>


<style type="text/css">
.elementor .elementor-widget:not(.elementor-widget-text-editor) .wp-block-image figure {
    margin-left: auto;
    margin-right: auto;
}</style>


<style type="text/css">
/* Add your CSS code here.

For example:
.example {
    color: red;
}

For brushing up on your CSS knowledge, check out http://www.w3schools.com/css/css_syntax.asp

End of comment */ 

code {
 color: #009699;
 background-color: #F7FCFC;
}</style>


<style type="text/css">
.pseudo-code {
  font-family: monaco, monospace;
  font-size: 14px;
  line-height: 1.5;
  color:white;
  white-space: pre;
  background-color:#333333;
  margin-bottom:1em;
  padding:8px;
}</style>


<style type="text/css">
.tldr {
	box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
	margin-bottom: 2em;
}

@media (min-width: 600px) { 
  .tldr .wp-block-media-text__content,
  .tldr .wp-block-media-text .wp-block-media-text__content{
    padding-top: 2em !important;
  }
}

@media (max-width: 600px) {
h2, .entry-content h2 {
    margin-top: 1em;
}
}</style>


<script type="text/javascript">
var $j = jQuery.noConflict();
// $j is now an alias to the jQuery function; creating the new alias is optional.
 
$j(document).ready(function() {
  setTimeout(function(){
  	$j('.elementor-nav-menu--dropdown.elementor-nav-menu__container').css('height', $j(document).height());
  }, 1500);
});

</script>

<link rel="stylesheet" id="608-css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/608.css" type="text/css" media="all">
<link rel="pingback" href="https://blog.zecops.com/xmlrpc.php">
<link rel="stylesheet" type="text/css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/shCore.css"><link rel="stylesheet" type="text/css" href="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/shThemeRDark.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<link rel="icon" href="blog_zecops_com_wp-content_uploads/2020/04/favicon.png" sizes="32x32">
<link rel="icon" href="blog_zecops_com_wp-content_uploads/2020/04/favicon.png" sizes="192x192">
<link rel="apple-touch-icon" href="blog_zecops_com_wp-content_uploads/2020/04/favicon.png">
<meta name="msapplication-TileImage" content="blog_zecops_com_wp-content_uploads/2020/04/favicon.png">
<style type="text/css" id="wp-custom-css">
			h1, .entry-content h1, h2, .entry-content h2, h3, .entry-content h3, h4, .entry-content h4, h5, .entry-content h5, h6, .entry-content h6 {
    margin-bottom: 0.5em;
}

.ast-separate-container #wpwrap .edit-post-visual-editor, .ast-page-builder-template #wpwrap .edit-post-visual-editor, .ast-plain-container #wpwrap .edit-post-visual-editor {
    background-color: red;
}


/* helper class: gray border for white BG images */
.border img {
	border: 1px solid #ddd;
}		</style>

<script async="" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/js"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-104258807-19');
</script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/sharethis.js"></script>
<script type="text/javascript" defer="defer" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/ebc65754-14d0-4b0e-bab5-fe23b2d089f0.js"></script><style type="text/css">#st-1 {
  font-family: "Helvetica Neue", Verdana, Helvetica, Arial, sans-serif;;
  direction: ltr;
  display: block;
  opacity: 1;
  text-align: right;
  z-index: 94034;
}
#st-1.st-animated {
  -moz-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; -ms-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; -o-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; -webkit-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in;
}
#st-1.st-hidden {
  opacity: 0;
}
#st-1.st-hide {
  display: none;
}
#st-1 .st-btn {
  -moz-box-sizing: border-box;
-webkit-box-sizing: border-box;
box-sizing: border-box;
  -moz-transition: opacity 0.2s ease-in, top 0.2s ease-in; -ms-transition: opacity 0.2s ease-in, top 0.2s ease-in; -o-transition: opacity 0.2s ease-in, top 0.2s ease-in; -webkit-transition: opacity 0.2s ease-in, top 0.2s ease-in; transition: opacity 0.2s ease-in, top 0.2s ease-in;
  -moz-border-radius: 4px;
-webkit-border-radius: 4px;
border-radius: 4px;
  border: none;
  cursor: pointer;
  display: inline-block;
  font-size: 12px;
  height: 32px;
  line-height: 32px;
  margin-right: 8px;
  padding: 0 10px;
  position: relative;
  text-align: center;
  top: 0;
  vertical-align: top;
  white-space: nowrap;
}
#st-1 .st-btn:last-child {
  margin-right: 0;
}
#st-1 .st-btn > svg {
  height: 16px;
  width: 16px;
  position: relative;
  top: 8px;
  vertical-align: top;
}
#st-1 .st-btn > img {
  display: inline-block;
  height: 16px;
  width: 16px;
  position: relative;
  top: 8px;
  vertical-align: top;
}
#st-1 .st-btn > span {
  -moz-transition: all 0.2s ease-in; -ms-transition: all 0.2s ease-in; -o-transition: all 0.2s ease-in; -webkit-transition: all 0.2s ease-in; transition: all 0.2s ease-in;
  color: #fff;
  display: inline-block;
  font-weight: 500;
  letter-spacing: 0.5px;
  min-width: 60px;
  opacity: 1;
  padding: 0 6px;
  position: relative;
  vertical-align: top;
}
#st-1.st-has-labels .st-btn {
  min-width: 120px;
}
#st-1.st-has-labels .st-btn.st-remove-label {
  min-width: 50px;
}
#st-1.st-has-labels .st-btn.st-remove-label > span {
  display: none;
}
#st-1.st-has-labels .st-btn.st-hide-label > span {
  display: none;
}
#st-1 .st-total {
  color: #555;
  display: inline-block;
  font-weight: 500;
  line-height: 12px;
  margin-right: 0;
  max-width: 80px;
  padding: 4px 8px;
  text-align: center;
}
#st-1 .st-total.st-hidden {
  display: none;
}
#st-1 .st-total > span {
  font-size: 16px;
  line-height: 17px;
  display: block;
  padding: 0;
}
#st-1 .st-total > span.st-shares {
  font-size: 9px;
  line-height: 9px;
}
#st-1.st-justified {
  display: flex;
  text-align: center;
}
#st-1.st-justified .st-btn {
  -moz-flex: 1;
-ms-flex: 1;
-webkit-flex: 1;
flex: 1;
}#st-1 .st-btn:hover {
  opacity: .8;
  top: -4px;
}#st-1 .st-btn[data-network='facebook'] {
  background-color: #4267B2;
}
#st-1 .st-btn[data-network='facebook'] svg {
  fill: #fff;
}
#st-1 .st-btn[data-network='facebook'] > span {
  color: #fff;
}
#st-1 .st-btn[data-network='twitter'] {
  background-color: #55acee;
}
#st-1 .st-btn[data-network='twitter'] svg {
  fill: #fff;
}
#st-1 .st-btn[data-network='twitter'] > span {
  color: #fff;
}
#st-1 .st-btn[data-network='linkedin'] {
  background-color: #0077b5;
}
#st-1 .st-btn[data-network='linkedin'] svg {
  fill: #fff;
}
#st-1 .st-btn[data-network='linkedin'] > span {
  color: #fff;
}</style><style type="text/css">#st-3 {
  font-family: "Helvetica Neue", Verdana, Helvetica, Arial, sans-serif;;
  direction: ltr;
  display: block;
  opacity: 1;
  text-align: right;
  z-index: 94034;
}
#st-3.st-animated {
  -moz-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; -ms-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; -o-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; -webkit-transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in; transition: o 0.2s ease-in, p 0.2s ease-in, a 0.2s ease-in, c 0.2s ease-in, i 0.2s ease-in, t 0.2s ease-in, y 0.2s ease-in;
}
#st-3.st-hidden {
  opacity: 0;
}
#st-3.st-hide {
  display: none;
}
#st-3 .st-btn {
  -moz-box-sizing: border-box;
-webkit-box-sizing: border-box;
box-sizing: border-box;
  -moz-transition: opacity 0.2s ease-in, top 0.2s ease-in; -ms-transition: opacity 0.2s ease-in, top 0.2s ease-in; -o-transition: opacity 0.2s ease-in, top 0.2s ease-in; -webkit-transition: opacity 0.2s ease-in, top 0.2s ease-in; transition: opacity 0.2s ease-in, top 0.2s ease-in;
  -moz-border-radius: 4px;
-webkit-border-radius: 4px;
border-radius: 4px;
  border: none;
  cursor: pointer;
  display: inline-block;
  font-size: 12px;
  height: 32px;
  line-height: 32px;
  margin-right: 8px;
  padding: 0 10px;
  position: relative;
  text-align: center;
  top: 0;
  vertical-align: top;
  white-space: nowrap;
}
#st-3 .st-btn:last-child {
  margin-right: 0;
}
#st-3 .st-btn > svg {
  height: 16px;
  width: 16px;
  position: relative;
  top: 8px;
  vertical-align: top;
}
#st-3 .st-btn > img {
  display: inline-block;
  height: 16px;
  width: 16px;
  position: relative;
  top: 8px;
  vertical-align: top;
}
#st-3 .st-btn > span {
  -moz-transition: all 0.2s ease-in; -ms-transition: all 0.2s ease-in; -o-transition: all 0.2s ease-in; -webkit-transition: all 0.2s ease-in; transition: all 0.2s ease-in;
  color: #fff;
  display: inline-block;
  font-weight: 500;
  letter-spacing: 0.5px;
  min-width: 60px;
  opacity: 1;
  padding: 0 6px;
  position: relative;
  vertical-align: top;
}
#st-3.st-has-labels .st-btn {
  min-width: 120px;
}
#st-3.st-has-labels .st-btn.st-remove-label {
  min-width: 50px;
}
#st-3.st-has-labels .st-btn.st-remove-label > span {
  display: none;
}
#st-3.st-has-labels .st-btn.st-hide-label > span {
  display: none;
}
#st-3 .st-total {
  color: #555;
  display: inline-block;
  font-weight: 500;
  line-height: 12px;
  margin-right: 0;
  max-width: 80px;
  padding: 4px 8px;
  text-align: center;
}
#st-3 .st-total.st-hidden {
  display: none;
}
#st-3 .st-total > span {
  font-size: 16px;
  line-height: 17px;
  display: block;
  padding: 0;
}
#st-3 .st-total > span.st-shares {
  font-size: 9px;
  line-height: 9px;
}
#st-3.st-justified {
  display: flex;
  text-align: center;
}
#st-3.st-justified .st-btn {
  -moz-flex: 1;
-ms-flex: 1;
-webkit-flex: 1;
flex: 1;
}#st-3 .st-btn:hover {
  opacity: .8;
  top: -4px;
}#st-3 .st-btn[data-network='facebook'] {
  background-color: #4267B2;
}
#st-3 .st-btn[data-network='facebook'] svg {
  fill: #fff;
}
#st-3 .st-btn[data-network='facebook'] > span {
  color: #fff;
}
#st-3 .st-btn[data-network='twitter'] {
  background-color: #55acee;
}
#st-3 .st-btn[data-network='twitter'] svg {
  fill: #fff;
}
#st-3 .st-btn[data-network='twitter'] > span {
  color: #fff;
}
#st-3 .st-btn[data-network='linkedin'] {
  background-color: #0077b5;
}
#st-3 .st-btn[data-network='linkedin'] svg {
  fill: #fff;
}
#st-3 .st-btn[data-network='linkedin'] > span {
  color: #fff;
}</style></head><body itemtype="https://schema.org/Blog" itemscope="itemscope" class="post-template-default single single-post postid-846 single-format-standard wp-custom-logo ast-desktop ast-page-builder-template ast-no-sidebar astra-1.6.4 ast-header-custom-item-inside ast-blog-single-style-1 ast-single-post ast-inherit-site-logo-transparent elementor-page-73 ast-normal-title-enabled elementor-default elementor-kit-1166" style="margin-top: 0px;" data-elementor-device-mode="desktop">
<div id="page" class="hfeed site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
 <div data-elementor-type="header" data-elementor-id="36" class="elementor elementor-36 elementor-location-header" data-elementor-settings="[]">
<div class="elementor-inner">
<div class="elementor-section-wrap">
<section class="elementor-element elementor-element-1511372 elementor-section-stretched elementor-section-full_width elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="1511372" data-element_type="section" data-settings="{&quot;stretch_section&quot;:&quot;section-stretched&quot;}" style="width: 1362px; left: 0px;">
<div class="elementor-container elementor-column-gap-no">
<div class="elementor-row">
<div class="elementor-element elementor-element-a841497 elementor-column elementor-col-100 elementor-top-column" data-id="a841497" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-79af2b8 elementor-widget elementor-widget-html" data-id="79af2b8" data-element_type="widget" data-widget_type="html.default">
<div class="elementor-widget-container">
<div class="notif" style="display: none">
<img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/notif-arrow.html" alt="" class="notif-arrow">
<a href="https://www.zecops.com/contact-us?subj=Meet+Zecops+at+BlackHat+2019+and+DEF+CON+27" target="_blank" class="notif-link w-inline-block">
<div>
<strong>Meet Zecops at BlackHat 2019 &amp; DEF CON 27 </strong> | <u>Schedule a meeting</u>
</div>
</a>
</div> </div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<header class="elementor-element elementor-element-8bde1fb elementor-section-content-middle elementor-section-height-min-height elementor-section-boxed elementor-section-height-default elementor-section-items-middle elementor-section elementor-top-section" data-id="8bde1fb" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
<div class="elementor-container elementor-column-gap-no">
<div class="elementor-row">
<div class="elementor-element elementor-element-57ecf16a elementor-column elementor-col-25 elementor-top-column" data-id="57ecf16a" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-3cf6a1f6 elementor-widget elementor-widget-theme-site-logo elementor-widget-image" data-id="3cf6a1f6" data-element_type="widget" data-widget_type="theme-site-logo.default">
<div class="elementor-widget-container">
<div class="elementor-image">
<a href="https://blog.zecops.com/">
<img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/zecops-blog-logo.svg" class="astra-logo-svg" alt="" width="100%" height="100%"> </a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-31a3f902 elementor-column elementor-col-50 elementor-top-column" data-id="31a3f902" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-41375340 elementor-nav-menu__align-right elementor-nav-menu--stretch elementor-nav-menu--indicator-none elementor-nav-menu--dropdown-tablet elementor-nav-menu__text-align-aside elementor-nav-menu--toggle elementor-nav-menu--burger elementor-widget elementor-widget-nav-menu" data-id="41375340" data-element_type="widget" data-settings="{&quot;full_width&quot;:&quot;stretch&quot;,&quot;layout&quot;:&quot;horizontal&quot;,&quot;toggle&quot;:&quot;burger&quot;}" data-widget_type="nav-menu.default">
<div class="elementor-widget-container">
<nav role="navigation" class="elementor-nav-menu--main elementor-nav-menu__container elementor-nav-menu--layout-horizontal e--pointer-none"><ul id="menu-1-41375340" class="elementor-nav-menu" data-smartmenus-id="1594759025395846"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-945"><a href="#" class="elementor-item elementor-item-anchor has-submenu" id="sm-1594759025395846-1" aria-haspopup="true" aria-controls="sm-1594759025395846-2" aria-expanded="false">Solutions<span class="sub-arrow"><i class="fa"></i></span></a>
<ul class="sub-menu elementor-nav-menu--dropdown" id="sm-1594759025395846-2" role="group" aria-hidden="true" aria-labelledby="sm-1594759025395846-1" aria-expanded="false">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-946"><a href="https://www.zecops.com/solutions/gluon" class="elementor-sub-item">Gluon</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-947"><a href="https://www.zecops.com/solutions/neutrino" class="elementor-sub-item">Neutrino</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-948"><a href="https://www.zecops.com/solutions/electron" class="elementor-sub-item">Electron</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-949"><a href="#" class="elementor-item elementor-item-anchor has-submenu" id="sm-1594759025395846-3" aria-haspopup="true" aria-controls="sm-1594759025395846-4" aria-expanded="false">Company<span class="sub-arrow"><i class="fa"></i></span></a>
<ul class="sub-menu elementor-nav-menu--dropdown" id="sm-1594759025395846-4" role="group" aria-hidden="true" aria-labelledby="sm-1594759025395846-3" aria-expanded="false">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-648"><a href="https://www.zecops.com/company/about-us" class="elementor-sub-item">About</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-814"><a href="https://www.zecops.com/company/news" class="elementor-sub-item">News</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-815"><a href="https://www.zecops.com/company/events" class="elementor-sub-item">Events</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-611"><a href="https://www.zecops.com/contact/contact-us" class="elementor-sub-item">Contact</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-650"><a href="https://www.zecops.com/contact/find-a-reseller" class="elementor-item">Find a Reseller</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-28"><a href="https://zecops.com/" class="elementor-item">ZecOps.com</a></li>
</ul></nav>
<div class="elementor-menu-toggle" role="button" tabindex="0" aria-label="Menu Toggle" aria-expanded="false" style="">
<i class="eicon-menu-bar" aria-hidden="true"></i>
<span class="elementor-screen-only">Menu</span>
</div>
<nav class="elementor-nav-menu--dropdown elementor-nav-menu__container" role="navigation" aria-hidden="true" style="width: 1362px; left: 0px; top: 43px;"><ul id="menu-2-41375340" class="elementor-nav-menu" data-smartmenus-id="15947590253995996"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-945"><a href="#" class="elementor-item elementor-item-anchor has-submenu" id="sm-15947590253995996-1" aria-haspopup="true" aria-controls="sm-15947590253995996-2" aria-expanded="false">Solutions<span class="sub-arrow"><i class="fa"></i></span></a>
<ul class="sub-menu elementor-nav-menu--dropdown" id="sm-15947590253995996-2" role="group" aria-hidden="true" aria-labelledby="sm-15947590253995996-1" aria-expanded="false">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-946"><a href="https://www.zecops.com/solutions/gluon" class="elementor-sub-item">Gluon</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-947"><a href="https://www.zecops.com/solutions/neutrino" class="elementor-sub-item">Neutrino</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-948"><a href="https://www.zecops.com/solutions/electron" class="elementor-sub-item">Electron</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-949"><a href="#" class="elementor-item elementor-item-anchor has-submenu" id="sm-15947590253995996-3" aria-haspopup="true" aria-controls="sm-15947590253995996-4" aria-expanded="false">Company<span class="sub-arrow"><i class="fa"></i></span></a>
<ul class="sub-menu elementor-nav-menu--dropdown" id="sm-15947590253995996-4" role="group" aria-hidden="true" aria-labelledby="sm-15947590253995996-3" aria-expanded="false">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-648"><a href="https://www.zecops.com/company/about-us" class="elementor-sub-item">About</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-814"><a href="https://www.zecops.com/company/news" class="elementor-sub-item">News</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-815"><a href="https://www.zecops.com/company/events" class="elementor-sub-item">Events</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-611"><a href="https://www.zecops.com/contact/contact-us" class="elementor-sub-item">Contact</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-650"><a href="https://www.zecops.com/contact/find-a-reseller" class="elementor-item">Find a Reseller</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-28"><a href="https://zecops.com/" class="elementor-item">ZecOps.com</a></li>
</ul></nav>
</div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-1ed5d71b elementor-column elementor-col-25 elementor-top-column" data-id="1ed5d71b" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-4f1d242c elementor-search-form--skin-minimal elementor-widget elementor-widget-search-form" data-id="4f1d242c" data-element_type="widget" data-settings="{&quot;skin&quot;:&quot;minimal&quot;}" data-widget_type="search-form.default">
<div class="elementor-widget-container">
<form class="elementor-search-form" role="search" action="https://blog.zecops.com" method="get">
<div class="elementor-search-form__container">
<div class="elementor-search-form__icon">
<i class="fa fa-search" aria-hidden="true"></i>
<span class="elementor-screen-only">Search</span>
</div>
<input placeholder="Search..." class="elementor-search-form__input" type="search" name="s" title="Search">
</div>
</form>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</header>
</div>
</div>
</div>
<div id="content" class="site-content">
<div class="ast-container">
<div id="primary" class="content-area primary">
 <main id="main" class="site-main" role="main">
 <div data-elementor-type="single" data-elementor-id="73" class="elementor elementor-73 elementor-location-single post-846 post type-post status-publish format-standard has-post-thumbnail hentry category-vulnerabilities ast-article-single" data-elementor-settings="[]">
<div class="elementor-inner">
<div class="elementor-section-wrap">
<section class="elementor-element elementor-element-52e7df60 elementor-section-height-min-height elementor-section-boxed elementor-section-height-default elementor-section-items-middle elementor-section elementor-top-section" data-id="52e7df60" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
<div class="elementor-background-overlay"></div>
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-49a1dd47 elementor-column elementor-col-100 elementor-top-column" data-id="49a1dd47" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-cb0a03a elementor-widget elementor-widget-theme-post-title elementor-page-title elementor-widget-heading" data-id="cb0a03a" data-element_type="widget" data-widget_type="theme-post-title.default">
<div class="elementor-widget-container">
<h1 class="elementor-heading-title elementor-size-default">Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC</h1> </div>
</div>
<div class="elementor-element elementor-element-5c744e98 elementor-align-center elementor-widget elementor-widget-post-info" data-id="5c744e98" data-element_type="widget" data-widget_type="post-info.default">
<div class="elementor-widget-container">
<ul class="elementor-inline-items elementor-icon-list-items elementor-post-info">
<li class="elementor-icon-list-item elementor-repeater-item-9b232b3 elementor-inline-item" itemprop="author">
<a href="https://blog.zecops.com/author/admin/">
<span class="elementor-icon-list-text elementor-post-info__item elementor-post-info__item--type-author">
<span class="elementor-post-info__item-prefix">By</span>
ZecOps Research Team </span>
</a>
</li>
<li class="elementor-icon-list-item elementor-repeater-item-f7a06a1 elementor-inline-item" itemprop="datePublished">
<span class="elementor-icon-list-text elementor-post-info__item elementor-post-info__item--type-date">
<span class="elementor-post-info__item-prefix">|&nbsp;&nbsp;</span>
March 31, 2020 </span>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="elementor-element elementor-element-70c16113 elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="70c16113" data-element_type="section">
<div class="elementor-container elementor-column-gap-no">
<div class="elementor-row">
<div class="elementor-element elementor-element-378dc609 elementor-column elementor-col-100 elementor-top-column" data-id="378dc609" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-3ac481ff elementor-widget elementor-widget-image" data-id="3ac481ff" data-element_type="widget" data-widget_type="image.default">
<div class="elementor-widget-container">
<div class="elementor-image">
<img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/profile2x.png" class="attachment-large size-large" alt="" srcset="blog_zecops_com_wp-content_uploads/2019/01/profile@2x.png 562w, blog_zecops_com_wp-content_uploads/2019/01/profile@2x-150x150.png 150w, blog_zecops_com_wp-content_uploads/2019/01/profile@2x-300x300.png 300w" sizes="(max-width: 562px) 100vw, 562px" width="562" height="562"> </div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="elementor-element elementor-element-7b7c10a elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="7b7c10a" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-575d802 elementor-column elementor-col-100 elementor-top-column" data-id="575d802" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<section class="elementor-element elementor-element-9811ef6 elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-inner-section" data-id="9811ef6" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-d2fa511 elementor-column elementor-col-33 elementor-inner-column" data-id="d2fa511" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-697202f elementor-widget elementor-widget-heading" data-id="697202f" data-element_type="widget" data-widget_type="heading.default">
<div class="elementor-widget-container">
<h2 class="elementor-heading-title elementor-size-default">SHARE THIS ARTICLE</h2> </div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-94c494e elementor-column elementor-col-66 elementor-inner-column" data-id="94c494e" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-3181c0a elementor-widget elementor-widget-html" data-id="3181c0a" data-element_type="widget" data-widget_type="html.default">
<div class="elementor-widget-container">

<div class="sharethis-inline-share-buttons st-right st-has-labels  st-inline-share-buttons st-animated" id="st-1"><div class="st-total ">
  <span class="st-label">3.6k</span>
  <span class="st-shares">
    Shares
  </span>
</div><div class="st-btn st-first" data-network="facebook" style="display: inline-block;" data-title="Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC - ZecOps Blog">
  <img alt="facebook sharing button" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/facebook.svg">
  <span class="st-label">321</span>
</div><div class="st-btn" data-network="twitter" style="display: inline-block;">
  <img alt="twitter sharing button" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/twitter.svg">
  <span class="st-label">994</span>
</div><div class="st-btn st-last" data-network="linkedin" style="display: inline-block;" data-title="Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC - ZecOps Blog">
  <img alt="linkedin sharing button" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/linkedin.svg">
  <span class="st-label">111</span>
</div></div> </div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="elementor-element elementor-element-5f95bc16 elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="5f95bc16" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-5a0c3ff6 elementor-column elementor-col-100 elementor-top-column" data-id="5a0c3ff6" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-630e77ad elementor-widget elementor-widget-theme-post-content" data-id="630e77ad" data-element_type="widget" data-widget_type="theme-post-content.default">
<div class="elementor-widget-container">
<h2><a id="post-846-_b33vok7boy3d"></a>Introduction</h2>
<p>CVE-2020-0796 is a bug in the compression mechanism of SMBv3.1.1, 
also known as “SMBGhost”. The bug affects Windows 10 versions 1903 and 
1909, and it was <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/adv200005">announced</a> and patched by Microsoft about three weeks ago. Once we heard about it, we skimmed over the details and created a quick <a href="https://blog.zecops.com/vulnerabilities/vulnerability-reproduction-cve-2020-0796-poc/">POC</a>
 (proof of concept) that demonstrates how the bug can be triggered 
remotely, without authentication, by causing a BSOD (Blue Screen of 
Death). A couple of days ago we returned to this bug for more than just a
 remote DoS. The Microsoft Security Advisory describes the bug as a 
remote code execution (RCE) vulnerability, but there is no public POC 
that demonstrates RCE through this bug.</p>
<h2><a id="post-846-_ejt3kweqfeuu"></a>Initial Analysis</h2>
<p>The bug is an integer overflow bug that happens in the <code>Srv2DecompressData</code> function in the srv2.sys SMB server driver. Here’s a simplified version of the function, with the irrelevant details omitted:</p>
<div><div id="highlighter_486336" class="syntaxhighlighter nice-code-block cpp"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp keyword bold">typedef</code> <code class="cpp keyword bold">struct</code> <code class="cpp plain">_COMPRESSION_TRANSFORM_HEADER</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">ULONG</code> <code class="cpp plain">ProtocolId;</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">ULONG</code> <code class="cpp plain">OriginalCompressedSegmentSize;</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">USHORT</code> <code class="cpp plain">CompressionAlgorithm;</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">USHORT</code> <code class="cpp plain">Flags;</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">ULONG</code> <code class="cpp plain">Offset;</code></div><div class="line number8 index7 alt1"><code class="cpp plain">} COMPRESSION_TRANSFORM_HEADER, *PCOMPRESSION_TRANSFORM_HEADER;</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="cpp keyword bold">typedef</code> <code class="cpp keyword bold">struct</code> <code class="cpp plain">_ALLOCATION_HEADER</code></div><div class="line number11 index10 alt2"><code class="cpp plain">{</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// ...</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">PVOID</code> <code class="cpp plain">UserBuffer;</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// ...</code></div><div class="line number15 index14 alt2"><code class="cpp plain">} ALLOCATION_HEADER, *PALLOCATION_HEADER;</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="cpp plain">NTSTATUS Srv2DecompressData(PCOMPRESSION_TRANSFORM_HEADER Header, </code><code class="cpp color1 bold">SIZE_T</code> <code class="cpp plain">TotalSize)</code></div><div class="line number18 index17 alt1"><code class="cpp plain">{</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">PALLOCATION_HEADER Alloc = SrvNetAllocateBuffer(</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">(</code><code class="cpp color1 bold">ULONG</code><code class="cpp plain">)(Header-&gt;OriginalCompressedSegmentSize + Header-&gt;Offset),</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">NULL);</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">If (!Alloc) {</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">STATUS_INSUFFICIENT_RESOURCES;</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">ULONG</code> <code class="cpp plain">FinalCompressedSize = 0;</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">NTSTATUS Status = SmbCompressionDecompress(</code></div><div class="line number29 index28 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Header-&gt;CompressionAlgorithm,</code></div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">(</code><code class="cpp color1 bold">PUCHAR</code><code class="cpp plain">)Header + </code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(COMPRESSION_TRANSFORM_HEADER) + Header-&gt;Offset,</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">(</code><code class="cpp color1 bold">ULONG</code><code class="cpp plain">)(TotalSize - </code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(COMPRESSION_TRANSFORM_HEADER) - Header-&gt;Offset),</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">(</code><code class="cpp color1 bold">PUCHAR</code><code class="cpp plain">)Alloc-&gt;UserBuffer + Header-&gt;Offset,</code></div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Header-&gt;OriginalCompressedSegmentSize,</code></div><div class="line number34 index33 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">&amp;FinalCompressedSize);</code></div><div class="line number35 index34 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(Status &lt; 0 || FinalCompressedSize != Header-&gt;OriginalCompressedSegmentSize) {</code></div><div class="line number36 index35 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">SrvNetFreeBuffer(Alloc);</code></div><div class="line number37 index36 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">STATUS_BAD_DATA;</code></div><div class="line number38 index37 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(Header-&gt;Offset &gt; 0) {</code></div><div class="line number41 index40 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp functions bold">memcpy</code><code class="cpp plain">(</code></div><div class="line number42 index41 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Alloc-&gt;UserBuffer,</code></div><div class="line number43 index42 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">(</code><code class="cpp color1 bold">PUCHAR</code><code class="cpp plain">)Header + </code><code class="cpp keyword bold">sizeof</code><code class="cpp plain">(COMPRESSION_TRANSFORM_HEADER),</code></div><div class="line number44 index43 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Header-&gt;Offset);</code></div><div class="line number45 index44 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number46 index45 alt1">&nbsp;</div><div class="line number47 index46 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Srv2ReplaceReceiveBuffer(some_session_handle, Alloc);</code></div><div class="line number48 index47 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">STATUS_SUCCESS;</code></div><div class="line number49 index48 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>The <code>Srv2DecompressData</code> function receives the compressed 
message which is sent by the client, allocates the required amount of 
memory, and decompresses the data. Then, if the <code>Offset</code> field is not zero it copies the data that is placed before the compressed data as is to the beginning of the allocated buffer.</p>
<div class="wp-block-image"><figure class="aligncenter"><img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/word-image.png" alt="" class="wp-image-847"></figure></div>
<p>If we look carefully, we can notice that lines 20 and 31 can lead to 
an integer overflow for certain inputs. For example, most POCs that 
appeared shortly after the bug publication and crashed the system just 
used the <code>0xFFFFFFFF</code> value for the <em><code>Offset</code></em> field. Using the value <code>0xFFFFFFFF</code> triggers an integer overflow on line 20, and as a result less bytes are allocated.</p>
<p>Later, it triggers an additional integer overflow on line 31. The 
crash happens due to a memory access at the address calculated in line 
30, far away from the received message. If the code verified the 
calculation at line 31, it would bail out early since the buffer length 
happens to be negative and cannot be represented, and that makes the 
address itself on line 30 invalid as well.</p>
<div class="wp-block-image"><figure class="aligncenter"><img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/word-image-1.png" alt="" class="wp-image-848"></figure></div>
<h2><a id="post-846-_sh6miqorfqie"></a>Choosing what to overflow</h2>
<p>There are only two relevant fields that we can control to cause an integer overflow: <em><code>OriginalCompressedSegmentSize</code></em> and <em><code>Offset</code></em>,
 so there aren’t that many options. After trying several combinations, 
the following combination caught our eye: what if we send a legit <code>Offset</code> value and a huge <code>OriginalCompressedSegmentSize</code> value? Let’s go over the three steps the code is going to execute:</p>
<ol><li><strong>Allocate:</strong> The amount of allocated bytes will be smaller than the sum of both fields due to the integer overflow.</li><li><strong>Decompress:</strong> The decompression will receive a huge <code>OriginalCompressedSegmentSize</code>
 value, treating the target buffer as practically having limitless size.
 All other parameters are unaffected thus it will work as expected.</li><li><strong>Copy:</strong> If it’s ever going to be executed (will it?), the copy will work as expected.</li></ol>
<p>Whether or not the Copy step is going to be executed, it already 
looks interesting – we can trigger an out of bounds write on the 
Decompress stage since we managed to allocate less bytes then necessary 
on the Allocate stage.</p>
<div class="wp-block-image"><figure class="aligncenter"><img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/word-image-2.png" alt="" class="wp-image-849"></figure></div>
<p>As you can see, using this technique we can trigger an overflow of 
any size and content, which is a great start. But what is located beyond
 our buffer? Let’s find out!</p>
<h2><a id="post-846-_2ybk5cpj9yk0"></a>Diving into SrvNetAllocateBuffer</h2>
<p>To answer this question, we need to look at the allocation function, in our case <code>SrvNetAllocateBuffer</code>. Here is the interesting part of the function:</p>
<div><div id="highlighter_471070" class="syntaxhighlighter nice-code-block cpp"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">PALLOCATION_HEADER SrvNetAllocateBuffer(</code><code class="cpp color1 bold">SIZE_T</code> <code class="cpp plain">AllocSize, PALLOCATION_HEADER SourceBuffer)</code></div><div class="line number2 index1 alt1"><code class="cpp plain">{</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// ...</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(SrvDisableNetBufferLookAsideList || AllocSize &gt; 0x100100) {</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(AllocSize &gt; 0x1000100) {</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">NULL;</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Result = SrvNetAllocateBufferFromPool(AllocSize, AllocSize);</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">} </code><code class="cpp keyword bold">else</code> <code class="cpp plain">{</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">int</code> <code class="cpp plain">LookasideListIndex = 0;</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(AllocSize &gt; 0x1100) {</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">LookasideListIndex = </code><code class="cpp comments">/* some calculation based on AllocSize */</code><code class="cpp plain">;</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">SOME_STRUCT list = SrvNetBufferLookasides[LookasideListIndex];</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Result = </code><code class="cpp comments">/* fetch result from list */</code><code class="cpp plain">;</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// Initialize some Result fields...</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">Result;</code></div><div class="line number23 index22 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>We can see that the allocation function does different things 
depending on the required amount of bytes. Large allocations (larger 
than about 16 MB) just fail. Medium allocations (larger than about 1 MB)
 use the <code>SrvNetAllocateBufferFromPool</code> function for the allocation. Small allocations (the rest) use lookaside lists for optimization.</p>
<p><strong>Note:</strong> There’s also the <code>SrvDisableNetBufferLookAsideList</code>
 flag which can affect the functionality of the function, but it’s set 
by an undocumented registry setting and is disabled by default, so it’s 
not very interesting.</p>
<p>Lookaside lists are used for effectively reserving a set of reusable,
 fixed-size buffers for the driver. One of the capabilities of lookaside
 lists is to define a custom allocation/free functions which will be 
used for managing the buffers. Looking at references for the <code>SrvNetBufferLookasides</code> array, we found that it’s initialized in the <code>SrvNetCreateBufferLookasides</code> function, and by looking at it we learned the following:</p>
<ul><li>The custom allocation function is defined as <code>SrvNetBufferLookasideAllocate</code>, which just calls <code>SrvNetAllocateBufferFromPool</code>.</li><li>9 lookaside lists are created with the following sizes, as we quickly calculated with Python: <br>
<span class="inline-code-block">
&gt;&gt;&gt; [hex((1 &lt;&lt; (i + 12)) + 256) for i in range(9)]<br>[‘0x1100’, ‘0x2100’, ‘0x4100’, ‘0x8100’, ‘0x10100’, ‘0x20100’, ‘0x40100’, ‘0x80100’, ‘0x100100’]
</span>
<br>It matches our finding that allocations larger than <code>0x100100</code> bytes are allocated without using lookaside lists.</li></ul>
<p>The conclusion is that every allocation request ends up in the <code>SrvNetAllocateBufferFromPool</code> function, so let’s take a look at it.</p>
<h2><a id="post-846-_kd7fhz808y"></a>SrvNetAllocateBufferFromPool and the allocated buffer layout</h2>
<p>The <code>SrvNetAllocateBufferFromPool</code> function allocates a buffer in the <code>NonPagedPoolNx</code> pool using the <code>ExAllocatePoolWithTag</code> function, and then fills some of the structures with data. The layout of the allocated buffer is the following:</p>
<div class="wp-block-image"><figure class="aligncenter"><img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/word-image-3.png" alt="" class="wp-image-850"></figure></div>
<p>The only relevant parts of this layout for the scope of our research are the user buffer and the <code>ALLOCATION_HEADER</code> struct. We can see right away that by overflowing the user buffer, we end up overriding the <code>ALLOCATION_HEADER</code> struct. Looks very convenient.</p>
<h2><a id="post-846-_z2pndbgjuwey"></a>Overriding the ALLOCATION_HEADER struct</h2>
<p>Our first thought at this point was that due to the check that follows the <code>SmbCompressionDecompress</code> call:</p>
<pre class="wp-block-preformatted">if (Status &lt; 0 || FinalCompressedSize != Header-&gt;OriginalCompressedSegmentSize) {
    SrvNetFreeBuffer(Alloc);
    return STATUS_BAD_DATA;
}</pre>
<p><code>SrvNetFreeBuffer</code> will be called and the function will fail, since we crafted <code>OriginalCompressedSegmentSize</code> to be a huge number, and <code>FinalCompressedSize</code> is going to be a smaller number which represents the actual amount of decompressed bytes. So we analyzed the <code>SrvNetFreeBuffer</code>
 function, managed to replace the allocation pointer to a magic number, 
and waited for the free function to try and free it, hoping to leverage 
it later for use-after-free or similar. But to our surprise, we got a 
crash in the <code>memcpy</code> function. That has made us happy, since
 we didn’t hope to get there at all, but we had to check why it 
happened. The explanation can be found in the implementation of the <code>SmbCompressionDecompress</code> function:</p>
<div><div id="highlighter_269943" class="syntaxhighlighter nice-code-block cpp"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">01</div><div class="line number2 index1 alt1">02</div><div class="line number3 index2 alt2">03</div><div class="line number4 index3 alt1">04</div><div class="line number5 index4 alt2">05</div><div class="line number6 index5 alt1">06</div><div class="line number7 index6 alt2">07</div><div class="line number8 index7 alt1">08</div><div class="line number9 index8 alt2">09</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">NTSTATUS SmbCompressionDecompress(</code></div><div class="line number2 index1 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">USHORT</code> <code class="cpp plain">CompressionAlgorithm,</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">PUCHAR</code> <code class="cpp plain">UncompressedBuffer,</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">ULONG</code>&nbsp; <code class="cpp plain">UncompressedBufferSize,</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">PUCHAR</code> <code class="cpp plain">CompressedBuffer,</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">ULONG</code>&nbsp; <code class="cpp plain">CompressedBufferSize,</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp color1 bold">PULONG</code> <code class="cpp plain">FinalCompressedSize)</code></div><div class="line number8 index7 alt1"><code class="cpp plain">{</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// ...</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">NTSTATUS Status = RtlDecompressBufferEx2(</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">...,</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">FinalUncompressedSize,</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">...);</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">(Status &gt;= 0) {</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">*FinalCompressedSize = CompressedBufferSize;</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp comments">// ...</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">return</code> <code class="cpp plain">Status;</code></div><div class="line number22 index21 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>Basically, if the decompression succeeds, <code>FinalCompressedSize</code> is updated to hold the value of <code>CompressedBufferSize</code>, which is the size of the buffer. This deliberate update of the <code>FinalCompressedSize</code>
 return value seemed quite suspicious for us, since this little detail, 
together with the allocated buffer layout, allows for a very convenient 
exploitation of this bug.</p>
<p>Since the execution continues to the stage of copying the raw data, let’s review the call once again:</p>
<pre class="wp-block-preformatted">memcpy(
    Alloc-&gt;UserBuffer,
    (PUCHAR)Header + sizeof(COMPRESSION_TRANSFORM_HEADER),
    Header-&gt;Offset);</pre>
<p>The target address is read from the <code>ALLOCATION_HEADER</code> 
struct, the one that we can override. The content and the size of the 
buffer are controlled by us as well. Jackpot! Write-what-where in the 
kernel, remotely!</p>
<h2><a id="post-846-_5flmclpbbokf"></a>Remote write-what-where implementation</h2>
<p>We did a quick implementation of a <a href="https://github.com/ZecOps/CVE-2020-0796-LPE-POC/blob/master/write_what_where.py">Write-What-Where CVE-2020-0796 Exploit</a> in Python, which is based on the CVE-2020-0796 DoS POC of <a href="https://twitter.com/maxpl0it">maxpl0it</a>. The code is fairly short and straightforward.</p>
<h2><a id="post-846-_4vmpqir64j8z"></a>Local Privilege Escalation</h2>
<p>Now that we have the write-what-where exploit, what can we do with 
it? Obviously we can crash the system. We might be able to trigger 
remote code execution, but we didn’t find a way to do that yet. If we 
use the exploit on localhost and leak additional information, we can use
 it for local privilege escalation, as it was already demonstrated to be
 possible via several techniques.</p>
<p>The first technique we tried was proposed by Morten Schenk in his <a href="https://www.blackhat.com/docs/us-17/wednesday/us-17-Schenk-Taking-Windows-10-Kernel-Exploitation-To-The-Next-Level%E2%80%93Leveraging-Write-What-Where-Vulnerabilities-In-Creators-Update.pdf">Black Hat USA 2017 talk</a>. The technique involves overriding a function pointer in the <code>.data</code> section of the <code>win32kbase.sys</code> driver, and then calling the appropriate function from user mode to gain code execution. j00ru wrote <a href="https://j00ru.vexillium.org/2018/07/exploiting-a-windows-10-pagedpool-off-by-one/">a great writeup</a>
 about using this technique in WCTF 2018, and provided his exploit 
source code. We adjusted it for our write-what-where exploit, but found 
out that it doesn’t work since the thread that handles the SMB messages 
is not a GUI thread. Due to this, <code>win32kbase.sys</code> is not mapped, and the technique is not relevant (unless there’s a way to make it a GUI thread, something we didn’t research).</p>
<p>We ended up using the well known technique covered by <a href="https://twitter.com/cesarcer">cesarcer</a> in 2012 in his Black Hat presentation <a href="https://media.blackhat.com/bh-us-12/Briefings/Cerrudo/BH_US_12_Cerrudo_Windows_Kernel_WP.pdf">Easy Local Windows Kernel Exploitation</a>. The technique is about leaking the current process token address by using the <code>NtQuerySystemInformation(SystemHandleInformation)</code> API, and then overriding it, granting the current process token privileges that can then be used for privilege escalation. The <a href="https://github.com/hatRiot/token-priv/blob/master/abusing_token_eop_1.0.txt">Abusing Token Privileges For EoP</a> research by Bryan Alexander (<a href="https://twitter.com/dronesec">dronesec</a>) and Stephen Breen (<a href="https://twitter.com/breenmachine">breenmachine</a>) (2017) demonstrates several ways of using various token privileges for privilege escalation.</p>
<p>We based our exploit on the code that <a href="https://segfault.me/">Alexandre Beaulieu</a> kindly shared in his <a href="https://segfault.me/2019/05/24/exploiting-an-arbitrary-write-to-escalate-privileges/">Exploiting an Arbitrary Write to Escalate Privileges</a> writeup. We completed the privilege escalation after modifying our process’ token privileges by injecting a DLL into <code>winlogon.exe</code>. The DLL’s whole purpose is to launch a privileged instance of <code>cmd.exe</code>. Our complete Local Privilege Escalation Proof of Concept can be found <a href="https://github.com/ZecOps/CVE-2020-0796-LPE-POC">here</a> and is available for research / defensive purposes only.</p>
<h2><a id="post-846-_tedhz6yrgoqw"></a>Summary</h2>
<p>We managed to demonstrate that the CVE-2020-0796 vulnerability can be
 exploited for local privilege escalation. Note that our exploit is 
limited for medium integrity level, since it relies on API calls that 
are unavailable in a lower integrity level. Can we do more than that? 
Maybe, but it will require more research. There are many other fields 
that we can override in the allocated buffer, perhaps one of them can 
help us achieve other interesting things such as remote code execution.</p>
<p><a href="https://github.com/ZecOps/CVE-2020-0796-LPE-POC">POC Source Code</a></p>
<div class="wp-block-image"><figure class="aligncenter size-large"><img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/CVE-2020-0796-Privilege-Escalation-POC-original.gif" alt="" class="wp-image-861"></figure></div>
<h2><a id="post-846-_fr4u7msc8prd"></a>Remediation</h2>
<ol><li>We recommend updating servers and endpoints to the latest 
Windows version to remediate this vulnerability. If possible, block port
 445 until updates are deployed. Regardless of CVE-2020-0796, we 
recommend enabling host-isolation where possible.</li><li>It is possible
 to disable SMBv3.1.1 compression in order to avoid triggers to this 
bug, however we recommend to do full update instead if possible.</li></ol>
<div class="wp-block-columns zecops-blog-callout">
<div class="wp-block-column">
<h2><a id="post-846-_e62tpunuly2g"></a>ZecOps Customers &amp; Partners</h2>
<p>ZecOps Digital Forensics and Incident Response (DFIR) customers can 
detect such exploitation attempts as “CVE-2020-0796” using ZecOps 
agentless solution: <strong>Neutrino for Servers and Endpoints</strong>. To try ZecOps technology and see a demo, you can contact us <a href="https://www.zecops.com/request-demo"><strong>here</strong></a></p>
</div>
<div class="wp-block-column">
<h2><a id="post-846-_st5oxvn1kkof"></a>Researchers wanted</h2>
<p>At ZecOps we’re working on offensive cyber security research for 
defensive purposes. We are hiring additional researchers &amp; exploit 
developers in various platforms including iOS and Windows. If you are 
interested, contact us <a href="https://www.zecops.com/jobs"><strong>here</strong></a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="elementor-element elementor-element-b631fe9 elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="b631fe9" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-f14eb49 elementor-column elementor-col-33 elementor-top-column" data-id="f14eb49" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-6494467 elementor-widget elementor-widget-html" data-id="6494467" data-element_type="widget" data-widget_type="html.default">
<div class="elementor-widget-container">
<img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/reverse-bounty.png" alt="reverse bounty">
</div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-a875ca4 elementor-column elementor-col-33 elementor-top-column" data-id="a875ca4" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-b03034f elementor-widget elementor-widget-html" data-id="b03034f" data-element_type="widget" data-widget_type="html.default">
<div class="elementor-widget-container">
<p><strong>Researcher? Analyst?</strong></p>
<p>If you get excited about exploits reproduction like we do, you would love ZecOps Reverse Bounty program - details ahead!</p>
<p><a href="https://www.zecops.com/reverse-bounty">Join Reverse Bounty™ &gt;</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-835e41f elementor-column elementor-col-33 elementor-top-column" data-id="835e41f" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-de2111e elementor-widget elementor-widget-html" data-id="de2111e" data-element_type="widget" data-widget_type="html.default">
<div class="elementor-widget-container">
<p><strong>Partners, Resellers, Distributors and Innovative Security Teams</strong></p>
<p>We’re still in stealth mode, but… we are already working with leading
 organizations globally. If you wish to learn more about what we do and 
what fresh vibes we bring to defensive cyber security, let’s get in 
touch</p>
<p><a href="https://www.zecops.com/contact-us">Contact Us &gt;</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<div class="elementor-element elementor-element-9dcec24 elementor-section-content-middle elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="9dcec24" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-3ed404f elementor-column elementor-col-33 elementor-top-column" data-id="3ed404f" data-element_type="column">
<div class="elementor-column-wrap">
<div class="elementor-widget-wrap">
</div>
</div>
</div>
<div class="elementor-element elementor-element-8107ebd elementor-column elementor-col-66 elementor-top-column" data-id="8107ebd" data-element_type="column">
<div class="elementor-column-wrap">
<div class="elementor-widget-wrap">
</div>
</div>
</div>
</div>
</div>
</div>
<section class="elementor-element elementor-element-2110924 elementor-section-content-middle elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="2110924" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-bcb7679 elementor-column elementor-col-100 elementor-top-column" data-id="bcb7679" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-5812b2d elementor-widget elementor-widget-divider" data-id="5812b2d" data-element_type="widget" data-widget_type="divider.default">
<div class="elementor-widget-container">
<div class="elementor-divider">
<span class="elementor-divider-separator">
</span>
</div>
</div>
</div>
<section class="elementor-element elementor-element-5641d86 elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-inner-section" data-id="5641d86" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-a068aec elementor-column elementor-col-33 elementor-inner-column" data-id="a068aec" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-65a09d2 elementor-widget elementor-widget-heading" data-id="65a09d2" data-element_type="widget" data-widget_type="heading.default">
<div class="elementor-widget-container">
<h2 class="elementor-heading-title elementor-size-default">SHARE THIS ARTICLE</h2> </div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-c21f480 elementor-column elementor-col-66 elementor-inner-column" data-id="c21f480" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-3a77cb3 elementor-widget elementor-widget-html" data-id="3a77cb3" data-element_type="widget" data-widget_type="html.default">
<div class="elementor-widget-container">
<div class="sharethis-inline-share-buttons st-right st-has-labels  st-inline-share-buttons st-animated" id="st-3"><div class="st-total ">
  <span class="st-label">3.6k</span>
  <span class="st-shares">
    Shares
  </span>
</div><div class="st-btn st-first" data-network="facebook" style="display: inline-block;" data-title="Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC - ZecOps Blog">
  <img alt="facebook sharing button" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/facebook.svg">
  <span class="st-label">321</span>
</div><div class="st-btn" data-network="twitter" style="display: inline-block;">
  <img alt="twitter sharing button" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/twitter.svg">
  <span class="st-label">994</span>
</div><div class="st-btn st-last" data-network="linkedin" style="display: inline-block;" data-title="Exploiting SMBGhost (CVE-2020-0796) for a Local Privilege Escalation: Writeup + POC - ZecOps Blog">
  <img alt="linkedin sharing button" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/linkedin.svg">
  <span class="st-label">111</span>
</div></div> </div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<div class="elementor-element elementor-element-2d99078 elementor-widget elementor-widget-divider" data-id="2d99078" data-element_type="widget" data-widget_type="divider.default">
<div class="elementor-widget-container">
<div class="elementor-divider">
<span class="elementor-divider-separator">
</span>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="elementor-element elementor-element-3db28eda elementor-section-boxed elementor-section-height-default elementor-section-height-default elementor-section elementor-top-section" data-id="3db28eda" data-element_type="section">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-59b45c81 elementor-column elementor-col-100 elementor-top-column" data-id="59b45c81" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-43d43542 elementor-widget elementor-widget-post-navigation" data-id="43d43542" data-element_type="widget" data-widget_type="post-navigation.default">
<div class="elementor-widget-container">
<div class="elementor-post-navigation elementor-grid">
<div class="elementor-post-navigation__prev elementor-post-navigation__link">
<a href="https://blog.zecops.com/vulnerabilities/vulnerability-reproduction-cve-2020-0796-poc/" rel="prev"><span class="post-navigation__arrow-wrapper post-navigation__arrow-prev"><i class="fa fa-angle-left" aria-hidden="true"></i><span class="elementor-screen-only">Prev</span></span><span class="elementor-post-navigation__link__prev"><span class="post-navigation__prev--label">Previous</span><span class="post-navigation__prev--title">Vulnerability Reproduction: CVE-2020-0796 POC</span></span></a> </div>
<div class="elementor-post-navigation__next elementor-post-navigation__link">
<a href="https://blog.zecops.com/vulnerabilities/youve-got-0-click-mail/" rel="next"><span class="elementor-post-navigation__link__next"><span class="post-navigation__next--label">Next</span><span class="post-navigation__next--title">You’ve Got (0-click) Mail!</span></span><span class="post-navigation__arrow-wrapper post-navigation__arrow-next"><i class="fa fa-angle-right" aria-hidden="true"></i><span class="elementor-screen-only">Next</span></span></a> </div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
</div>
</div>
</main>
</div>
</div> 
</div>
 <div data-elementor-type="footer" data-elementor-id="66" class="elementor elementor-66 elementor-location-footer" data-elementor-settings="[]">
<div class="elementor-inner">
<div class="elementor-section-wrap">
<section class="elementor-element elementor-element-2c8b1dd elementor-section-height-min-height elementor-section-content-middle elementor-section-boxed elementor-section-height-default elementor-section-items-middle elementor-section elementor-top-section" data-id="2c8b1dd" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
<div class="elementor-container elementor-column-gap-default">
<div class="elementor-row">
<div class="elementor-element elementor-element-4a1f9cb4 elementor-column elementor-col-33 elementor-top-column" data-id="4a1f9cb4" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-7d4f78b elementor-widget elementor-widget-image" data-id="7d4f78b" data-element_type="widget" data-widget_type="image.default">
<div class="elementor-widget-container">
<div class="elementor-image">
<img src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/logo-white2x.png" class="attachment-large size-large" alt="" srcset="blog_zecops_com_wp-content_uploads/2019/01/logo-white@2x.png 320w, blog_zecops_com_wp-content_uploads/2019/01/logo-white@2x-300x92.png 300w" sizes="(max-width: 320px) 100vw, 320px" width="320" height="98"> </div>
</div>
</div>
</div>
</div>
</div>
<div class="elementor-element elementor-element-287b5a8a elementor-column elementor-col-66 elementor-top-column" data-id="287b5a8a" data-element_type="column">
<div class="elementor-column-wrap  elementor-element-populated">
<div class="elementor-widget-wrap">
<div class="elementor-element elementor-element-6ceb5a9 elementor-shape-square elementor-widget elementor-widget-social-icons" data-id="6ceb5a9" data-element_type="widget" data-widget_type="social-icons.default">
<div class="elementor-widget-container">
<div class="elementor-social-icons-wrapper">
<a class="elementor-icon elementor-social-icon elementor-social-icon-facebook elementor-repeater-item-e48a4dc" href="https://www.facebook.com/zecopsinc/" target="_blank">
<span class="elementor-screen-only">Facebook</span>
<i class="fa fa-facebook"></i>
</a>
<a class="elementor-icon elementor-social-icon elementor-social-icon-twitter elementor-repeater-item-d97526a" href="https://twitter.com/zecops" target="_blank">
<span class="elementor-screen-only">Twitter</span>
<i class="fa fa-twitter"></i>
</a>
<a class="elementor-icon elementor-social-icon elementor-social-icon-linkedin elementor-repeater-item-4d44db2" href="https://www.linkedin.com/company/zecops/" target="_blank">
<span class="elementor-screen-only">Linkedin</span>
<i class="fa fa-linkedin"></i>
</a>
</div>
</div>
</div>
<div class="elementor-element elementor-element-757a6a0 elementor-widget elementor-widget-heading" data-id="757a6a0" data-element_type="widget" data-widget_type="heading.default">
<div class="elementor-widget-container">
<p class="elementor-heading-title elementor-size-default">ZecOps © 2020</p> </div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
</div>
</div>
</div>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/shCore.js"></script><iframe src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/portal-v2.html" id="st_gdpr_iframe" title="GDPR Consent Management" style="width: 0px; height: 0px; position: absolute; left: -5000px;"></iframe>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/shBrushCpp.js"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://blog.zecops.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://blog.zecops.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeRDark.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['auto-links'] = false;
	SyntaxHighlighter.defaults['class-name'] = 'nice-code-block';
	SyntaxHighlighter.defaults['pad-line-numbers'] = true;
	SyntaxHighlighter.defaults['smart-tabs'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<!--[if IE]>
<script type='text/javascript' src='https://blog.zecops.com/wp-content/themes/astra/assets/js/minified/flexibility.min.js?ver=1.6.4'></script>
<script type='text/javascript'>
flexibility(document.documentElement);
</script>
<![endif]-->
<script type="text/javascript">
/* <![CDATA[ */
var astra = {"break_point":"921","isRtl":""};
/* ]]> */
</script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/style.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/comment-reply.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/wp-embed.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/jquery_003.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/jquery-migrate.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/jquery_002.js"></script>
<script type="text/javascript">
var $j2 = jQuery.noConflict();
// $j is now an alias to the jQuery function; creating the new alias is optional.
 
$j2(document).ready(function() {
  setTimeout(function(){
    var $ogTitleElem = $j2("meta[property='og:title']");
    var ogTitle = $ogTitleElem.attr("content");
    var twitterTitle = $j2("meta[name='twitter:title']").attr("content");

    if(twitterTitle != ogTitle) {
      $j2(".st-btn[data-network='twitter']").attr("data-title", twitterTitle);
      $j2(".st-btn[data-network='facebook']").attr("data-title", ogTitle);
      $j2(".st-btn[data-network='linkedin']").attr("data-title", ogTitle);
      $ogTitleElem.remove();
    }

  }, 5000);
});
</script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/frontend-modules.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/jquery.js"></script>
<script type="text/javascript">
var ElementorProFrontendConfig = {"ajaxurl":"https:\/\/blog.zecops.com\/wp-admin\/admin-ajax.php","nonce":"140f67079e","i18n":{"toc_no_headings_found":"No headings were found on this page."},"shareButtonsNetworks":{"facebook":{"title":"Facebook","has_counter":true},"twitter":{"title":"Twitter"},"google":{"title":"Google+","has_counter":true},"linkedin":{"title":"LinkedIn","has_counter":true},"pinterest":{"title":"Pinterest","has_counter":true},"reddit":{"title":"Reddit","has_counter":true},"vk":{"title":"VK","has_counter":true},"odnoklassniki":{"title":"OK","has_counter":true},"tumblr":{"title":"Tumblr"},"delicious":{"title":"Delicious"},"digg":{"title":"Digg"},"skype":{"title":"Skype"},"stumbleupon":{"title":"StumbleUpon","has_counter":true},"mix":{"title":"Mix"},"telegram":{"title":"Telegram"},"pocket":{"title":"Pocket","has_counter":true},"xing":{"title":"XING","has_counter":true},"whatsapp":{"title":"WhatsApp"},"email":{"title":"Email"},"print":{"title":"Print"}},"facebook_sdk":{"lang":"en_US","app_id":""}};
</script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/frontend.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/position.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/dialog.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/waypoints.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/swiper.js"></script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/share-link.js"></script>
<script type="text/javascript">
var elementorFrontendConfig = {"environmentMode":{"edit":false,"wpPreview":false},"i18n":{"shareOnFacebook":"Share on Facebook","shareOnTwitter":"Share on Twitter","pinIt":"Pin it","downloadImage":"Download image"},"is_rtl":false,"breakpoints":{"xs":0,"sm":480,"md":768,"lg":1025,"xl":1440,"xxl":1600},"version":"2.9.11","urls":{"assets":"https:\/\/blog.zecops.com\/wp-content\/plugins\/elementor\/assets\/"},"settings":{"page":[],"general":{"elementor_global_image_lightbox":"yes","elementor_lightbox_enable_counter":"yes","elementor_lightbox_enable_fullscreen":"yes","elementor_lightbox_enable_zoom":"yes","elementor_lightbox_enable_share":"yes","elementor_lightbox_title_src":"title","elementor_lightbox_description_src":"description"},"editorPreferences":[]},"post":{"id":846,"title":"Exploiting%20SMBGhost%20%28CVE-2020-0796%29%20for%20a%20Local%20Privilege%20Escalation%3A%20Writeup%20%2B%20POC%20-%20ZecOps%20Blog","excerpt":"","featuredImage":"https:\/\/blog.zecops.com\/wp-content\/uploads\/2020\/03\/ghost-2a.jpg"}};
</script>
<script type="text/javascript" src="Exploiting%20SMBGhost%20for%20a%20Local%20Privilege%20Escalation_files/frontend_002.js"></script><span id="elementor-device-mode" class="elementor-screen-only"></span>
<script type="text/javascript">
    window._mfq = window._mfq || [];
    (function() {
        var mf = document.createElement("script");
        mf.type = "text/javascript"; mf.defer = true;
        mf.src = "//cdn.mouseflow.com/projects/ebc65754-14d0-4b0e-bab5-fe23b2d089f0.js";
        document.getElementsByTagName("head")[0].appendChild(mf);
    })();
</script>
<style>
  #promoMessage {
    font-family: "source code pro", monospace;
    position: fixed;
    left: 0px;
    right: 0px;
    top: 0px;
    z-index: 9999;
    display: block;
    background-color: #009699;
    text-align: center;
    color: white;
    padding: 12px 8px;
    font-size: 16px;
    line-height: 1.5;
  }
  #promoMessage button {
    color: #009699;
    background-color: rgba(255, 255, 255, 0.3);
    border: none;
    font-size: 16px;
    margin: 0 8px;
    float: right;
    padding: 4px 10px;
	line-height: 16px;
  }
  #promoMessage button:hover {
    background-color: white;
  }
  #promoMessage a:link,
  #promoMessage a:hover,
  #promoMessage a:visited {
    text-decoration: none;
    color: white;
    padding-bottom: 1px;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.5);
  }
  #promoMessage a:hover {
    border-bottom-color: white;
  }
  @media only screen and (max-width: 572px) {
    #promoMessage button {
      display: inline-block;
      float: none;
      margin-top: 8px;
    }
    #promoMessage {
      float: left;
    }
  }
</style>
<div id="promoMessage" style="display: none;">
<a href="https://zecops.com/solutions/gluon?utm_source=blog&amp;utm_medium=referral&amp;utm_campaign=detect-with-gluon-strip" target="_blank" rel="noopener noreferrer">
<span>
Detect iOS Attacks with ZecOps Gluon
</span>
</a>
<button id="hidePromoMessage">X</button>
</div>
<script type="text/javascript">
    var $j4 = jQuery.noConflict();
    $j4(document).ready( function() {
		$j4('#promoMessage').hide().trigger('modified');
		function setCookie(key, value) {
			var expDate = new Date();
			expDate.setTime(expDate.getTime() + (1 * 24 * 60 * 60 * 1000));
			document.cookie = key + '=' + value + ';expDate=' + expDate.toUTCString();
		}
		function getCookie(key) {
			var keyValue = document.cookie.match('(^|;) ?' + key + '=([^;]*)(;|$)');
			return keyValue ? keyValue[2] : null;
		}
		function handleCookieConsentGiven() {
			setCookie("blogPromo2513834176315", true);
		}
		if (!getCookie("blogPromo2513834176315")) {
			$j4('#promoMessage').show().trigger('modified');
		}
		else {
			handleCookieConsentGiven();
		}
		document.getElementById("hidePromoMessage").addEventListener("click", function() {
			handleCookieConsentGiven();
			$j4('#promoMessage').hide().trigger('modified');
		});
      
        $j4('#promoMessage').on('modified', function() {
          if($j4('#promoMessage').is(":visible") == true) {
              $j4('body').css('margin-top', $j4('#promoMessage').height()*1.8);
          } else {
              $j4('body').css('margin-top', 0);
          }
      	});
      
        if($j4('#promoMessage').is(":visible") == true) {
          		if($j4('body').hasClass('postid-1151') || $j4('body').hasClass('postid-1183') || $j4('body').hasClass('postid-1203')) {
                    $j4('#promoMessage a').attr('href', 'https://zecops.com/solutions/neutrino?utm_source=blog&utm_medium=referral&utm_campaign=detect-with-neutrino-strip');
                	$j4('#promoMessage span').html('Detect Attacks (like SMBleed)</b> with ZecOps Neutrino');
                }
                $j4('body').css('margin-top', $j4('#promoMessage').height()*1.8);
        }
      
	});
</script>

<script type="text/javascript">
_linkedin_partner_id = "2060060";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script><script type="text/javascript">
(function(){var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})();
</script>
<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=2060060&fmt=gif" />
</noscript>


</body></html>